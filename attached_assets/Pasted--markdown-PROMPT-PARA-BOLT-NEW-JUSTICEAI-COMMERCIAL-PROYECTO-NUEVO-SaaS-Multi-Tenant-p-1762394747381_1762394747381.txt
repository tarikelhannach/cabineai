```markdown
# ðŸš€ PROMPT PARA BOLT.NEW - JUSTICEAI COMMERCIAL

## PROYECTO NUEVO: SaaS Multi-Tenant para Despachos de Abogados

**Base de cÃ³digo**: Reutilizar JusticeAI gubernamental (FastAPI + React + PostgreSQL + Elasticsearch + OCR)

**Cambio**: De single-tenant (gobierno) â†’ multi-tenant (600 despachos independientes)

**Idiomas**: [translate:FrancÃ©s y Ãrabe] (sin espaÃ±ol)

---

## ðŸŽ¯ OBJETIVO GENERAL

Crear plataforma SaaS que permita a despachos de abogados:
1. **Digitalizar archivos histÃ³ricos**: 50,000 pÃ¡ginas de papel â†’ base de datos
2. **Procesar con IA**: OCR + BERT Ã¡rabe extrae automÃ¡ticamente personas, fechas, importes
3. **Buscar instantÃ¡neamente**: En todo el archivo (vs 30 minutos bÃºsqueda manual)
4. **Pagar por suscripciÃ³n**: Fee inicial (20-30K MAD) + 270 MAD/abogado/mes

---

## ðŸ’° MODELO COMERCIAL

```
DESPACHO PAGA:
â”œâ”€ Fee Inicial: 20,600 MAD (BÃ¡sico) o 30,600 MAD (Completo)
â”‚  â””â”€ Cubre: GPU 3 aÃ±os + capacitaciÃ³n + (digitalizaciÃ³n 50K si Completo)
â””â”€ Mensual: 270 MAD Ã— num_abogados
   â””â”€ Cubre: Procesamiento ilimitado + bÃºsqueda + soporte

EJEMPLO: Despacho 6 abogados
â”œâ”€ Paga inicial: 30,600 MAD
â”œâ”€ Paga mes 1-36: 1,620 MAD/mes (6 Ã— 270)
â””â”€ ROI: Recuperan inversiÃ³n en 1-2 meses
   â””â”€ Ahorran 52,000 MAD/mes en tiempo + espacio
```

---

## ðŸ”§ REQUISITOS TÃ‰CNICOS (FASE 1 - SEMANAS 1-6)

### 1. MULTI-TENANCY (CRÃTICO)

- Crear modelo `Firm` (despacho)
- Agregar `firm_id` FK a: `User`, `Document`, `Expediente`
- Crear middleware `TenantMiddleware` que filtra todas las queries por `firm_id`
- **Test**: Usuario A NO puede ver datos de Usuario B

### 2. SISTEMA DE USUARIOS (SOLO 3 ROLES)

```
class Role(str, Enum):
    ADMIN = "admin"              # DueÃ±o despacho
    LAWYER = "lawyer"            # Abogados
    ASSISTANT = "assistant"      # Paralegales
```

### 3. BILLING & SUSCRIPCIÃ“N

- Crear modelos: `Invoice`, `Subscription`
- Crear `BillingService` con mÃ©todos:
  - `calculate_monthly_fee(firm_id)` â†’ num_lawyers Ã— 270
  - `check_subscription_status(firm_id)` â†’ active/expired
  - `generate_invoice(firm_id, month, year)`
- Endpoints:
  - POST `/billing/init` (registro nuevo)
  - GET `/billing/invoice/current`
  - GET `/billing/status`
- **ValidaciÃ³n crÃ­tica**: Antes de procesar documento, verificar `subscription_status == 'active'`

### 4. I18N: [translate:FrancÃ©s + Ãrabe]

- Backend: Usar `fastapi-babel` con soporte i18n
- Frontend: `react-i18next` (ya existe en JusticeAI)
- Idiomas: [translate:fr] (francÃ©s), [translate:ar] (Ã¡rabe) + [translate:en] (inglÃ©s)
- RTL: Ãrabe con direcciÃ³n right-to-left automÃ¡tica
- Endpoints devuelven mensajes en idioma de usuario (Accept-Language header)

### 5. CONTEXTO DE BD

- Cambiar `Case` â†’ `Expediente` (nombrado para contexto comercial)
- Modificar schema: agregar `firm_id` FK a TODOS los modelos
- MigraciÃ³n Alembic: `alembic revision -m "add_multi_tenant"`

---

## âœ… TAREAS ESPECÃFICAS (EN ORDEN)

**SEMANA 1-2:**
- [ ] Crear carpeta proyecto: `justiceai-commercial/`
- [ ] Copiar cÃ³digo de JusticeAI gubernamental
- [ ] Actualizar docker-compose.yml
- [ ] Crear modelo `Firm` en `backend/app/models/firm.py`
- [ ] Agregar i18n base (carpeta locales, setup fastapi-babel)

**SEMANA 3-4:**
- [ ] Agregar `firm_id` FK a `User`, `Document`, `Expediente`, etc.
- [ ] Crear `backend/app/middleware/tenant.py`
- [ ] Crear `backend/app/middleware/language.py` (detect language from header)
- [ ] Modificar TODOS los endpoints para filtrar por `firm_id`
- [ ] Tests de aislamiento: 10 despachos, datos completamente aislados

**SEMANA 5-6:**
- [ ] Crear modelos `Invoice` + `Subscription`
- [ ] Crear `BillingService` con lÃ³gica de cÃ¡lculo
- [ ] Endpoints de billing: POST/GET
- [ ] ValidaciÃ³n en documento upload: `if subscription_status != 'active': raise 403`
- [ ] Testing: flujo completo de pago + renovaciÃ³n
- [ ] Traducir mensajes de error a [translate:fr] y [translate:ar]

---

## ðŸ—„ï¸ ESTRUCTURA MÃNIMA DE BD

```
Firm (despacho)
â”œâ”€â”€ id, name, email, phone
â”œâ”€â”€ subscription_tier: "basic" | "complete"
â”œâ”€â”€ subscription_status: "active" | "expired"
â”œâ”€â”€ subscription_start, subscription_end
â”œâ”€â”€ implementation_fee_paid: bool
â”œâ”€â”€ monthly_fee_per_lawyer: int (270)
â”œâ”€â”€ language_preference: "en" | "fr" | "ar"
â””â”€â”€ max_users, max_documents, max_storage_gb

User (adaptado)
â”œâ”€â”€ id, email, firm_id (FK) â† NUEVA
â”œâ”€â”€ role: "admin" | "lawyer" | "assistant"
â”œâ”€â”€ language: "en" | "fr" | "ar"
â””â”€â”€ (resto igual)

Document (adaptado)
â”œâ”€â”€ id, firm_id (FK) â† NUEVA
â”œâ”€â”€ filename, original_text
â”œâ”€â”€ entities (JSON), document_type, confidence_score
â””â”€â”€ (resto igual)

Expediente (fue Case, renombrado)
â”œâ”€â”€ id, firm_id (FK) â† NUEVA
â”œâ”€â”€ client_name, matter_type, status
â””â”€â”€ (resto igual)

Invoice (NUEVA)
â”œâ”€â”€ id, firm_id (FK)
â”œâ”€â”€ amount (MAD), invoice_date, due_date
â”œâ”€â”€ status: "pending" | "paid" | "overdue"
â””â”€â”€ invoice_number

Subscription (NUEVA)
â”œâ”€â”€ firm_id (PK), status, start_date, end_date
â”œâ”€â”€ plan_tier, monthly_cost
â””â”€â”€ next_billing_date
```

---

## ðŸŽ¯ DEFINICIÃ“N DE "LISTO"

Cuando FASE 1 estÃ© completa:

âœ… 10 despachos independientes sin data leaks
âœ… Multi-tenant funcional en todos los endpoints
âœ… Billing calcula automÃ¡ticamente monthly fee
âœ… SuscripciÃ³n se bloquea si vence
âœ… MigraciÃ³n BD sin errores
âœ… Tests de aislamiento pasan
âœ… Mensajes en [translate:FR/AR] segÃºn Accept-Language header
âœ… 0 errores 500 en operaciÃ³n bÃ¡sica

---

## ðŸ“ CONTEXTO REUTILIZABLE

**De JusticeAI gubernamental (REUTILIZAR):**
- âœ… FastAPI backend structure
- âœ… PostgreSQL schema (con adaptaciones)
- âœ… React frontend
- âœ… Docker infrastructure
- âœ… Celery workers (para despuÃ©s)
- âœ… OCR Tesseract (para despuÃ©s)
- âœ… Elasticsearch (para despuÃ©s)
- âœ… I18n framework (ya existe)

**Nuevo (CREAR):**
- ðŸ†• Modelo Firm
- ðŸ†• TenantMiddleware
- ðŸ†• BillingService
- ðŸ†• Invoice + Subscription models
- ðŸ†• Language detection middleware

---

## ðŸ’¡ I18N DETALLES

**Backend**:
```
from fastapi_babel import Babel

babel = Babel(app, default_locale='en', default_timezone='UTC')

@app.get("/test")
async def test(request: Request):
    # Detecta idioma de Accept-Language header
    lang = request.headers.get('Accept-Language', 'en').split(',')
    
    if lang == 'fr':
        return {"message": "Bienvenue"}  # FrancÃ©s
    elif lang == 'ar':
        return {"message": "Ø£Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§"}  # Ãrabe
    return {"message": "Welcome"}  # InglÃ©s
```

**Frontend**: 
- Ya existe `react-i18next` en JusticeAI
- Agregar traducciones para [translate:FR] y [translate:AR]
- RTL automÃ¡tico para Ã¡rabe

---

## ðŸš€ EMPEZAR

Copiar este prompt a Bolt y pedir:

> "Crear PROYECTO NUEVO: justiceai-commercial"
> "Reutilizar cÃ³digo de JusticeAI gubernamental"
> "Implementar FASE 1: Multi-tenancy + Billing + I18N (semanas 1-6)"
> "Idiomas: FrancÃ©s y Ãrabe (no espaÃ±ol)"
> "Primero: Crear modelo Firm + agregar firm_id a User, Document, Expediente"
> "Segundo: Crear middleware para tenant isolation"
> "Tercero: Setup i18n con fastapi-babel"

```

***

Â¿AsÃ­ estÃ¡ mejor? Sin referencias a espaÃ±ol, solo franÃ§ais y Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.

Sources
[1] Fastapi i18n: A step-by-step guide with examples https://lokalise.com/blog/fastapi-internationalization/
[2] Internationalization and Localization in FastAPI - App Generator https://app-generator.dev/docs/technologies/fastapi/i18n-localization.html
[3] FastAPI I18n Step by Step https://phrase.com/blog/posts/fastapi-i18n/
[4] FastAPI template Arabic translation render from right to left https://stackoverflow.com/questions/79313275/fastapi-template-arabic-translation-render-from-right-to-left
[5] How to create multilingual web pages with fastapi-babel? https://stackoverflow.com/questions/74958699/how-to-create-multilingual-web-pages-with-fastapi-babel
[6] GIScience/fastapi-i18n https://github.com/GIScience/fastapi-i18n
[7] Multilingual APIs: Internationalization and Localization Best ... https://python.plainenglish.io/multilingual-apis-internationalization-and-localization-best-practices-in-python-and-fastapi-aeff29d3eacd
[8] Support for Arabic Language #381 - remsky/Kokoro-FastAPI https://github.com/remsky/Kokoro-FastAPI/issues/381
