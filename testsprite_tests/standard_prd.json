{
  "meta": {
    "project": "CabineAI - Intelligent Legal SaaS for Morocco",
    "date": "2025-11-19",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "CabineAI is a specialized SaaS platform designed for Moroccan lawyers and law firms to digitize, categorize, and manage legal documents with AI-powered tools tailored to the legal context of Morocco. It supports multiple languages, including Arabic, French, and Spanish, and offers secure, compliant, and scalable management of legal practices.",
  "core_goals": [
    "Provide accurate digitization of paper archives into fully searchable digital documents using specialized OCR technology for Arabic, French, and Spanish.",
    "Leverage AI to automatically classify, summarize, and extract key information from legal documents to streamline legal workflows.",
    "Offer an interactive AI-powered legal assistant for contextual chat and document drafting tailored to Moroccan law.",
    "Ensure secure, multi-tenant data management with role-based access control and comprehensive audit logging for compliance and accountability."
  ],
  "key_features": [
    "Intelligent Document Digitalization with high-accuracy OCR and human-in-the-loop verification interface for 100% accuracy.",
    "AI-Powered Document Organization including auto-categorization, smart summaries, and automatic entity extraction.",
    "LLM-based Legal Assistant enabling contextual chat on case documents and AI-driven legal draft generation with custom templates.",
    "Comprehensive Practice Management with case organization, role-based access controls, and audit logs for security tracking.",
    "Robust Authentication including JWT, two-factor authentication, password reset, and multi-tenant user management.",
    "Full-Text Search over documents and cases powered by Elasticsearch for instant information retrieval.",
    "Digital Signature Management with Hardware Security Module (HSM) integration for signing and verification of documents.",
    "Subscription Billing Management integrated with Stripe for seamless payment processing and subscription handling.",
    "Performance Metrics and Monitoring APIs for operational insights and system health tracking."
  ],
  "user_flow_summary": [
    "Users register their law firm and administrator account to start using the platform.",
    "Lawyers and staff upload physical documents via a user-friendly interface that supports various formats and case associations.",
    "OCR processing occurs on uploaded documents with options for human verification to ensure text accuracy.",
    "AI automatically classifies documents and extracts key metadata such as dates, names, and legal categories.",
    "Users query their case documents through an advanced search or interact through the AI-powered chat assistant for information and document drafting.",
    "Administrators configure user roles and permissions to control access within the multi-tenant environment.",
    "Subscription management is handled via Stripe integration allowing users to manage their billing cycles and payments securely.",
    "All user actions are logged for audit purposes to maintain compliance and security.",
    "Digital signatures can be applied and verified on documents with strong cryptographic support."
  ],
  "validation_criteria": [
    "Achieve 100% OCR text accuracy confirmed through human-in-the-loop verification workflows.",
    "AI classification accuracy validated against benchmark legal document datasets relevant to Moroccan law.",
    "Successful end-to-end user authentication including 2FA, password resets, and RBAC functionality.",
    "System performance meets uptime and response time SLAs during document processing and AI responses.",
    "Complete audit logs are generated and retrievable for all user actions and document interactions.",
    "Stripe payment sessions and webhook events are processed securely without errors.",
    "All documents support fast full-text search with accurate results returned from Elasticsearch.",
    "Digital signature processes comply with cryptographic standards and pass signature verification tests.",
    "User interface fully supports Arabic, French, and Spanish with proper RTL layouts where applicable."
  ],
  "code_summary": {
    "tech_stack": [
      "Python 3.11",
      "FastAPI",
      "PostgreSQL 15",
      "Redis",
      "Elasticsearch 8.11",
      "Celery",
      "React 18",
      "Vite",
      "Material-UI",
      "Docker",
      "Nginx"
    ],
    "features": [
      {
        "name": "Authentication API",
        "description": "User authentication with JWT tokens, 2FA support, password reset, and user management",
        "files": [
          "backend/app/routes/auth.py",
          "backend/app/auth/auth.py",
          "backend/app/auth/jwt.py",
          "backend/app/auth/two_factor.py"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/auth/login": {
              "post": {
                "summary": "User login",
                "requestBody": {
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "email": {
                            "type": "string"
                          },
                          "password": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Login successful",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "access_token": {
                              "type": "string"
                            },
                            "token_type": {
                              "type": "string"
                            },
                            "user": {
                              "type": "object"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/auth/register": {
              "post": {
                "summary": "Register new firm and admin user"
              }
            },
            "/api/auth/login-2fa": {
              "post": {
                "summary": "Login with 2FA support"
              }
            },
            "/api/auth/2fa/enable": {
              "post": {
                "summary": "Enable 2FA for user"
              }
            },
            "/api/auth/2fa/verify": {
              "post": {
                "summary": "Verify 2FA code"
              }
            },
            "/api/auth/password/reset-request": {
              "post": {
                "summary": "Request password reset"
              }
            }
          }
        }
      },
      {
        "name": "Documents API",
        "description": "Document upload, download, OCR processing, and management with multi-tenant isolation",
        "files": [
          "backend/app/routes/documents.py",
          "backend/app/services/ocr_service.py"
        ],
        "api_doc": {
          "paths": {
            "/api/documents/upload": {
              "post": {
                "summary": "Upload document",
                "requestBody": {
                  "content": {
                    "multipart/form-data": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "file": {
                            "type": "string",
                            "format": "binary"
                          },
                          "case_id": {
                            "type": "integer"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/documents/{document_id}/download": {
              "get": {
                "summary": "Download document"
              }
            },
            "/api/documents/{document_id}": {
              "get": {
                "summary": "Get document details"
              },
              "delete": {
                "summary": "Delete document"
              }
            },
            "/api/documents/{document_id}/process-ocr": {
              "post": {
                "summary": "Process OCR for document"
              }
            }
          }
        }
      },
      {
        "name": "Cases API",
        "description": "Case/Expediente management with multi-tenant isolation and RBAC",
        "files": [
          "backend/app/routes/cases.py"
        ],
        "api_doc": {
          "paths": {
            "/api/cases/": {
              "get": {
                "summary": "List cases"
              },
              "post": {
                "summary": "Create new case"
              }
            },
            "/api/cases/{case_id}": {
              "get": {
                "summary": "Get case details"
              },
              "put": {
                "summary": "Update case"
              },
              "delete": {
                "summary": "Delete case"
              }
            },
            "/api/cases/search/": {
              "get": {
                "summary": "Search cases with filters"
              }
            }
          }
        }
      },
      {
        "name": "Chat RAG API",
        "description": "Intelligent chat with RAG (Retrieval-Augmented Generation) using GPT-4o and semantic search",
        "files": [
          "backend/app/routes/chat.py",
          "backend/app/services/rag_chat_service.py",
          "backend/app/services/embedding_service.py"
        ],
        "api_doc": {
          "paths": {
            "/api/chat/conversations": {
              "post": {
                "summary": "Create conversation"
              },
              "get": {
                "summary": "List conversations"
              }
            },
            "/api/chat/messages": {
              "post": {
                "summary": "Send message and get AI response"
              }
            },
            "/api/chat/documents/{document_id}/embed": {
              "post": {
                "summary": "Generate embeddings for document"
              }
            }
          }
        }
      },
      {
        "name": "AI Classification API",
        "description": "Automatic document classification using GPT-4o",
        "files": [
          "backend/app/routes/ai_classification.py",
          "backend/app/services/ai_classification_service.py"
        ],
        "api_doc": {
          "paths": {
            "/api/documents/{document_id}/classify": {
              "post": {
                "summary": "Classify document with AI"
              }
            },
            "/api/documents/{document_id}/classification": {
              "get": {
                "summary": "Get document classification"
              }
            }
          }
        }
      },
      {
        "name": "Document Drafting API",
        "description": "AI-powered legal document generation using GPT-4o with templates",
        "files": [
          "backend/app/routes/drafting.py",
          "backend/app/services/document_drafting_service.py"
        ],
        "api_doc": {
          "paths": {
            "/api/drafting/generate/template": {
              "post": {
                "summary": "Generate document from template"
              }
            },
            "/api/drafting/templates": {
              "post": {
                "summary": "Create template"
              },
              "get": {
                "summary": "List templates"
              }
            }
          }
        }
      },
      {
        "name": "Search API",
        "description": "Full-text search across documents and cases using Elasticsearch",
        "files": [
          "backend/app/routes/search.py",
          "backend/app/services/elasticsearch_service.py"
        ],
        "api_doc": {
          "paths": {
            "/api/search/documents": {
              "get": {
                "summary": "Search documents"
              }
            },
            "/api/search/cases": {
              "get": {
                "summary": "Search cases"
              }
            }
          }
        }
      },
      {
        "name": "Users API",
        "description": "User management with RBAC and multi-tenant support",
        "files": [
          "backend/app/routes/users.py"
        ],
        "api_doc": {
          "paths": {
            "/api/users/": {
              "get": {
                "summary": "List users"
              },
              "post": {
                "summary": "Create user"
              }
            },
            "/api/users/{user_id}": {
              "put": {
                "summary": "Update user"
              },
              "delete": {
                "summary": "Delete user"
              }
            }
          }
        }
      },
      {
        "name": "Billing API",
        "description": "Stripe integration for subscription management",
        "files": [
          "backend/app/routes/billing.py",
          "backend/app/services/stripe_service.py"
        ],
        "api_doc": {
          "paths": {
            "/api/billing/create-checkout-session": {
              "post": {
                "summary": "Create Stripe checkout session"
              }
            },
            "/api/billing/webhook": {
              "post": {
                "summary": "Stripe webhook handler"
              }
            }
          }
        }
      },
      {
        "name": "Audit API",
        "description": "Audit logging and compliance tracking",
        "files": [
          "backend/app/routes/audit.py"
        ],
        "api_doc": {
          "paths": {
            "/api/audit/logs": {
              "get": {
                "summary": "Get audit logs"
              }
            }
          }
        }
      },
      {
        "name": "Signatures API",
        "description": "Digital signature management with HSM support",
        "files": [
          "backend/app/routes/signatures.py"
        ],
        "api_doc": {
          "paths": {
            "/api/signatures/sign": {
              "post": {
                "summary": "Sign document"
              }
            },
            "/api/signatures/verify": {
              "post": {
                "summary": "Verify signature"
              }
            }
          }
        }
      },
      {
        "name": "Metrics API",
        "description": "Performance metrics and monitoring",
        "files": [
          "backend/app/routes/metrics.py",
          "backend/app/services/metrics_service.py"
        ],
        "api_doc": {
          "paths": {
            "/api/metrics/summary": {
              "get": {
                "summary": "Get metrics summary"
              }
            }
          }
        }
      }
    ]
  }
}
