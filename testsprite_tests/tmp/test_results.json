[
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "49a68c73-9c99-481c-9d1d-3d7928276b88",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC001-test_user_login_api",
    "description": "Verify that the /api/auth/login endpoint successfully authenticates a user with valid email and password, returning a valid JWT access token and user details.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\n\n\ndef test_user_login_api():\n    url = f\"{BASE_URL}/api/auth/login\"\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    # Use valid credentials for testing\n    payload = {\n        \"email\": \"testuser@example.com\",\n        \"password\": \"TestPassword123!\"\n    }\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=30)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n\n    json_response = response.json()\n    assert \"access_token\" in json_response, \"access_token is missing in response\"\n    assert isinstance(json_response[\"access_token\"], str) and len(json_response[\"access_token\"]) > 0, \"Invalid access_token\"\n    assert \"token_type\" in json_response, \"token_type is missing in response\"\n    assert json_response[\"token_type\"].lower() == \"bearer\", \"token_type should be 'bearer'\"\n    assert \"user\" in json_response, \"user details missing in response\"\n    assert isinstance(json_response[\"user\"], dict), \"user should be an object\"\n\n    # Optionally check expected fields inside user object\n    user = json_response[\"user\"]\n    assert \"email\" in user, \"user object missing 'email'\"\n    assert user[\"email\"].lower() == payload[\"email\"].lower(), \"Returned user email does not match login email\"\n\n\ntest_user_login_api()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 38, in <module>\n  File \"<string>\", line 25, in test_user_login_api\nAssertionError: access_token is missing in response\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.673Z",
    "modified": "2025-11-20T17:58:02.043Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "4d8921f5-d86a-46cc-ab34-919e1cd57f50",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC002-test_document_upload_api",
    "description": "Verify that the /api/documents/upload endpoint correctly accepts a document file and associated case_id, stores the document, and returns a success response.",
    "code": "import requests\nimport io\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_document_upload_api():\n    # First, create a new case to associate the document with\n    case_data = {\n        \"title\": \"Test Case for Document Upload\",\n        \"description\": \"Case created for testing document upload\"\n    }\n    headers = {\"Accept\": \"application/json\"}\n\n    case_id = None\n    document_id = None\n\n    try:\n        # Create case\n        response_case = requests.post(f\"{BASE_URL}/api/cases/\", json=case_data, headers=headers, timeout=TIMEOUT)\n        assert response_case.status_code in (200, 201), f\"Failed to create case: {response_case.text}\"\n        case_resp_json = response_case.json()\n        assert \"id\" in case_resp_json, f\"Case creation response missing 'id': {case_resp_json}\"\n        case_id = case_resp_json[\"id\"]\n\n        # Prepare a dummy file-like object to upload\n        dummy_content = b\"Sample text content for test document upload.\"\n        file_tuple = ('test_document.txt', io.BytesIO(dummy_content), 'text/plain')\n\n        # Upload document with the created case_id\n        files = {\n            \"file\": file_tuple,\n        }\n        data = {\n            \"case_id\": case_id,  # Pass as integer as per PRD\n        }\n\n        response_upload = requests.post(\n            f\"{BASE_URL}/api/documents/upload\",\n            files=files,\n            data=data,\n            headers={\"Accept\": \"application/json\"},\n            timeout=TIMEOUT\n        )\n\n        # Validate upload response\n        assert response_upload.status_code in (200, 201), (\n            f\"Unexpected status code when uploading document: {response_upload.status_code}, response: {response_upload.text}\"\n        )\n        resp_json = response_upload.json()\n        # Check for indicators of success: presence of document ID or success flag\n        assert resp_json is not None, \"Empty response from document upload\"\n        if \"id\" in resp_json:\n            document_id = resp_json[\"id\"]\n        elif \"document_id\" in resp_json:\n            document_id = resp_json[\"document_id\"]\n        elif \"success\" in resp_json:\n            assert resp_json[\"success\"] is True, \"Document upload did not return success True\"\n        else:\n            assert len(resp_json) > 0, \"No useful data in upload response\"\n\n    finally:\n        # Clean up: Delete uploaded document (if any) and the case\n        if document_id:\n            try:\n                del_resp = requests.delete(f\"{BASE_URL}/api/documents/{document_id}\", headers=headers, timeout=TIMEOUT)\n                assert del_resp.status_code in (200, 204), f\"Failed to delete document {document_id}\"\n            except Exception:\n                pass\n        if case_id:\n            try:\n                del_case_resp = requests.delete(f\"{BASE_URL}/api/cases/{case_id}\", headers=headers, timeout=TIMEOUT)\n                assert del_case_resp.status_code in (200, 204), f\"Failed to delete case {case_id}\"\n            except Exception:\n                pass\n\ntest_document_upload_api()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 77, in <module>\n  File \"<string>\", line 23, in test_document_upload_api\nAssertionError: Case creation response missing 'id': {'status': 'ok'}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.679Z",
    "modified": "2025-11-20T17:58:41.493Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "ab5cf73b-cb65-48af-ab43-df201f251f83",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC003-test_case_creation_api",
    "description": "Verify that the /api/cases/ POST endpoint allows creation of a new case with valid data and returns the created case details.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_case_creation_api():\n    url = f\"{BASE_URL}/api/cases/\"\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    # Minimal valid payload for case creation\n    payload = {\n        \"title\": \"New Legal Case Example\"\n    }\n\n    response = None\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n        assert response.status_code == 201, f\"Expected status code 201, got {response.status_code}\"\n        json_resp = response.json()\n        # Validate response contains expected fields and matches input data\n        assert \"id\" in json_resp, \"Response missing 'id' field\"\n        assert json_resp.get(\"title\") == payload[\"title\"], \"Title mismatch\"\n    finally:\n        if response is not None and response.status_code == 201:\n            created_case_id = response.json().get(\"id\")\n            if created_case_id:\n                del_url = f\"{BASE_URL}/api/cases/{created_case_id}\"\n                try:\n                    del_response = requests.delete(del_url, timeout=TIMEOUT)\n                    assert del_response.status_code == 204, f\"Failed to delete created case with id {created_case_id}\"\n                except Exception as e:\n                    # Just raise if deletion fails, so cleanup issues are visible\n                    raise e\n\ntest_case_creation_api()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 36, in <module>\n  File \"<string>\", line 19, in test_case_creation_api\nAssertionError: Expected status code 201, got 200\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.685Z",
    "modified": "2025-11-20T17:58:21.566Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "7511b214-41bb-4704-ac0c-1fc0ec36e03d",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC004-test_chat_send_message_api",
    "description": "Verify that the /api/chat/messages endpoint accepts a user message, processes it with the AI chat service, and returns an appropriate AI-generated response.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_chat_send_message_api():\n    url = f\"{BASE_URL}/api/chat/messages\"\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"message\": \"Hello, can you help me understand the process for filing a legal claim in Morocco?\"\n    }\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request to {url} failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200 but got {response.status_code}\"\n\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    # Validate AI-generated response presence and type\n    assert \"response\" in data, \"Response does not contain AI-generated response\"\n    ai_response = data.get(\"response\")\n    assert isinstance(ai_response, str), \"AI-generated response is not a string\"\n    assert len(ai_response) > 0, \"AI-generated response is empty\"\n\ntest_chat_send_message_api()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 34, in <module>\n  File \"<string>\", line 29, in test_chat_send_message_api\nAssertionError: Response does not contain AI-generated response\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.691Z",
    "modified": "2025-11-20T17:58:18.014Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "cd5c15df-aadc-4a47-ae82-6cb2532379cc",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC005-test_ai_document_classification_api",
    "description": "Verify that the /api/documents/{document_id}/classify endpoint triggers AI classification of the specified document and returns classification results.",
    "code": "import requests\nimport io\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\n# Assuming authentication is required, define login credentials here\nAUTH_EMAIL = \"admin@example.com\"\nAUTH_PASSWORD = \"StrongPassword123!\"\n\n\ndef get_auth_token():\n    try:\n        response = requests.post(\n            f\"{BASE_URL}/api/auth/login\",\n            json={\"email\": AUTH_EMAIL, \"password\": AUTH_PASSWORD},\n            timeout=TIMEOUT,\n        )\n        response.raise_for_status()\n        data = response.json()\n        return data.get(\"access_token\")\n    except Exception as e:\n        raise RuntimeError(f\"Authentication failed: {e}\")\n\n\ndef upload_sample_document(auth_token):\n    try:\n        # Create an in-memory dummy pdf file\n        file_content = b\"%PDF-1.4\\n%Dummy PDF file for testing\\n\"\n        dummy_file = io.BytesIO(file_content)\n        dummy_file.name = \"sample_document.pdf\"  # Some servers may require filename\n\n        headers = {\"Authorization\": f\"Bearer {auth_token}\"}\n        files = {\"file\": (dummy_file.name, dummy_file, \"application/pdf\")}\n        payload = {\"case_id\": \"1\"}  # case_id sent as string form field\n        response = requests.post(\n            f\"{BASE_URL}/api/documents/upload\",\n            headers=headers,\n            files=files,\n            data=payload,\n            timeout=TIMEOUT,\n        )\n        dummy_file.close()\n        response.raise_for_status()\n        json_data = response.json()\n        document_id = json_data.get(\"document_id\")\n        assert document_id is not None, \"Upload response missing 'document_id'\"\n        return document_id\n    except Exception as e:\n        raise RuntimeError(f\"Document upload failed: {e}\")\n\n\ndef delete_document(auth_token, document_id):\n    try:\n        headers = {\"Authorization\": f\"Bearer {auth_token}\"}\n        response = requests.delete(\n            f\"{BASE_URL}/api/documents/{document_id}\", headers=headers, timeout=TIMEOUT\n        )\n        response.raise_for_status()\n    except Exception as e:\n        # Log error but do not re-raise to ensure test teardown completes\n        print(f\"Warning: Failed to delete document {document_id}: {e}\")\n\n\ndef test_ai_document_classification_api():\n    auth_token = get_auth_token()\n    assert auth_token is not None, \"Failed to obtain auth token\"\n\n    headers = {\"Authorization\": f\"Bearer {auth_token}\", \"Content-Type\": \"application/json\"}\n\n    document_id = None\n    try:\n        # Upload a sample document to classify\n        document_id = upload_sample_document(auth_token)\n        assert document_id is not None, \"Uploaded document_id is None\"\n\n        # Trigger AI classification\n        response = requests.post(\n            f\"{BASE_URL}/api/documents/{document_id}/classify\",\n            headers=headers,\n            timeout=TIMEOUT,\n        )\n\n        # Validate response status code\n        assert response.status_code == 200, f\"Unexpected status code: {response.status_code}\"\n\n        classification_result = response.json()\n        # Validate that classification result contains expected keys\n        assert isinstance(classification_result, dict), \"Classification result is not a dict\"\n        assert len(classification_result) > 0, (\n            \"Classification result missing expected classification data\"\n        )\n\n    finally:\n        if document_id:\n            delete_document(auth_token, document_id)\n\n\ntest_ai_document_classification_api()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 99, in <module>\n  File \"<string>\", line 67, in test_ai_document_classification_api\nAssertionError: Failed to obtain auth token\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.696Z",
    "modified": "2025-11-20T17:58:43.064Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "140a1d3e-b9de-4903-93f2-64d11113d7ac",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC006-test_document_drafting_generate_template_api",
    "description": "Verify that the /api/drafting/generate/template endpoint generates a legal document from a specified template using AI and returns the generated document content.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_document_drafting_generate_template_api():\n    url_template_create = f\"{BASE_URL}/api/drafting/templates\"\n    url_generate = f\"{BASE_URL}/api/drafting/generate/template\"\n\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n\n    # Sample template data to create a template for testing\n    template_data = {\n        \"name\": \"Test Template\",\n        \"description\": \"Template for testing document drafting generation\",\n        \"content\": \"This is a legal template with placeholder {{client_name}}.\"\n    }\n\n    # Sample payload for generate template endpoint\n    generate_payload = {\n        \"template_name\": None,\n        \"parameters\": {\n            \"client_name\": \"John Doe\"\n        }\n    }\n\n    template_id = None\n\n    # Create a template first to ensure we have a template to generate from\n    try:\n        create_resp = requests.post(url_template_create, json=template_data, headers=headers, timeout=TIMEOUT)\n        assert create_resp.status_code == 201 or create_resp.status_code == 200, f\"Template creation failed: {create_resp.text}\"\n        created_template = create_resp.json()\n        assert \"name\" in created_template and created_template[\"name\"] == template_data[\"name\"]\n        assert \"id\" in created_template, \"Template ID not found in creation response\"\n\n        # Extract template identifier\n        template_id = created_template[\"id\"]\n\n        # Use the template name for generation as the API requires name\n        generate_payload[\"template_name\"] = template_data[\"name\"]\n\n        # Call the generate template endpoint\n        gen_resp = requests.post(url_generate, json=generate_payload, headers=headers, timeout=TIMEOUT)\n        assert gen_resp.status_code == 200, f\"Document generation failed: {gen_resp.text}\"\n\n        gen_result = gen_resp.json()\n\n        # Validate that generated document content is returned and contains expected replaced parameter\n        assert isinstance(gen_result, dict), \"Generated response is not a JSON object\"\n        assert \"generated_document\" in gen_result\n\n        content = gen_result.get(\"generated_document\")\n        assert isinstance(content, str), \"Generated document content is not a string\"\n        assert \"John Doe\" in content, \"Generated document content does not contain replaced parameter value\"\n\n    finally:\n        # Cleanup: Delete the created template if delete endpoint supported\n        # No delete template endpoint documented; so skipping delete step\n        pass\n\ntest_document_drafting_generate_template_api()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 64, in <module>\n  File \"<string>\", line 36, in test_document_drafting_generate_template_api\nAssertionError\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.702Z",
    "modified": "2025-11-20T17:58:38.774Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "8dfe2b61-716b-47ef-a783-3e356ab58d04",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC007-test_search_documents_api",
    "description": "Verify that the /api/search/documents endpoint performs a full-text search over documents and returns relevant search results based on query parameters.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_search_documents_api():\n    \"\"\"\n    Verify that the /api/search/documents endpoint performs a full-text search over documents\n    and returns relevant search results based on query parameters.\n    \"\"\"\n\n    # Example query parameter for full-text search\n    query_params = {\n        \"q\": \"contract termination\"\n    }\n    url = f\"{BASE_URL}/api/search/documents\"\n\n    try:\n        response = requests.get(url, params=query_params, timeout=TIMEOUT)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request to search documents API failed: {e}\"\n\n    # Validate response\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not a valid JSON\"\n\n    # Assuming the response is a JSON object with a list of documents in a key named \"results\"\n    assert \"results\" in data, \"Response JSON does not contain 'results' key\"\n    assert isinstance(data[\"results\"], list), \"'results' is not a list\"\n\n    # Check that at least 1 search result is returned (assuming indexed test data exists)\n    assert len(data[\"results\"]) > 0, \"No search results returned for valid query\"\n\n    # Each item should have relevant fields, for example: id, title, snippet\n    for doc in data[\"results\"]:\n        assert isinstance(doc, dict), \"Each search result should be a dict\"\n        assert \"id\" in doc, \"Document in results missing 'id'\"\n        assert \"title\" in doc, \"Document in results missing 'title'\"\n        assert \"snippet\" in doc, \"Document in results missing 'snippet'\"\n\ntest_search_documents_api()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"<string>\", line 20, in test_search_documents_api\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 404 Client Error: Not Found for url: http://localhost:8000/api/search/documents?q=contract+termination\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 44, in <module>\n  File \"<string>\", line 22, in test_search_documents_api\nAssertionError: Request to search documents API failed: 404 Client Error: Not Found for url: http://localhost:8000/api/search/documents?q=contract+termination\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.708Z",
    "modified": "2025-11-20T17:58:04.849Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "7ac76011-98de-4e86-9ffa-10ae1b825b68",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC008-test_user_creation_api",
    "description": "Verify that the /api/users/ POST endpoint creates a new user with valid data and assigns appropriate roles and permissions.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nUSERS_ENDPOINT = f\"{BASE_URL}/api/users/\"\nTIMEOUT = 30\n\ndef test_user_creation_api():\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    # Example valid user data with roles and permissions\n    user_data = {\n        \"email\": \"testuser@example.com\",\n        \"password\": \"StrongPassword!123\",\n        \"first_name\": \"Test\",\n        \"last_name\": \"User\",\n        \"roles\": [\"lawyer\", \"editor\"],\n        \"permissions\": [\"read_documents\", \"edit_documents\", \"upload_documents\"]\n    }\n\n    created_user_id = None\n\n    try:\n        # Create user\n        response = requests.post(\n            USERS_ENDPOINT,\n            json=user_data,\n            headers=headers,\n            timeout=TIMEOUT\n        )\n        assert response.status_code in (200, 201), f\"Expected status 200 or 201, got {response.status_code}\"\n        resp_json = response.json()\n\n        # If the user info is nested under 'user' key, adjust accordingly\n        user_info = resp_json.get(\"user\", resp_json)\n\n        # Validate keys existence\n        assert \"id\" in user_info, \"Response missing user id\"\n        assert user_info.get(\"email\") == user_data[\"email\"], \"Email mismatch in response\"\n        assert \"roles\" in user_info, \"Roles missing in response\"\n        assert \"permissions\" in user_info, \"Permissions missing in response\"\n        # Validate roles and permissions contain the assigned ones\n        for role in user_data[\"roles\"]:\n            assert role in user_info[\"roles\"], f\"Role {role} missing in response\"\n        for perm in user_data[\"permissions\"]:\n            assert perm in user_info[\"permissions\"], f\"Permission {perm} missing in response\"\n\n        created_user_id = user_info[\"id\"]\n\n    finally:\n        # Cleanup - delete the created user if created\n        if created_user_id is not None:\n            delete_url = f\"{USERS_ENDPOINT}{created_user_id}\"\n            try:\n                del_resp = requests.delete(delete_url, headers=headers, timeout=TIMEOUT)\n                # Accept 200 or 204 as success in deletion\n                assert del_resp.status_code in (200, 204), f\"Failed to delete user, status {del_resp.status_code}\"\n            except Exception:\n                pass\n\ntest_user_creation_api()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 61, in <module>\n  File \"<string>\", line 38, in test_user_creation_api\nAssertionError: Response missing user id\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.713Z",
    "modified": "2025-11-20T17:58:35.425Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "6b8b442a-3153-4867-a0fb-6611105b0b10",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC009-test_billing_create_checkout_session_api",
    "description": "Verify that the /api/billing/create-checkout-session endpoint creates a Stripe checkout session for subscription payment and returns session details.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_billing_create_checkout_session_api():\n    url = f\"{BASE_URL}/api/billing/create-checkout-session\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n    }\n    # Example payload for creating a checkout session, adjust as necessary\n    payload = {\n        \"mode\": \"subscription\",\n        \"line_items\": [\n            {\n                \"price\": \"price_12345\",  # Replace with valid Stripe price ID for subscription\n                \"quantity\": 1\n            }\n        ],\n        \"success_url\": \"https://example.com/success\",\n        \"cancel_url\": \"https://example.com/cancel\"\n    }\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request to create checkout session failed: {e}\"\n\n    content_type = response.headers.get(\"Content-Type\", \"\")\n    assert \"application/json\" in content_type, \\\n        f\"Response content-type is not application/json, got: {content_type}\"\n\n    data = response.json()\n    assert isinstance(data, dict), f\"Response JSON is not an object: {data}\"\n\n    assert \"id\" in data, f\"Response missing 'id' field: {data}\"\n    assert isinstance(data[\"id\"], str), f\"Response 'id' is not a string: {data['id']}\"\n    assert data[\"id\"].startswith(\"cs_\"), f\"Response 'id' does not start with 'cs_': {data['id']}\"\n\n    assert \"url\" in data, f\"Response missing 'url' field: {data}\"\n    assert isinstance(data[\"url\"], str), f\"Response 'url' is not a string: {data['url']}\"\n    assert data[\"url\"].startswith(\"http\"), f\"Response 'url' does not start with 'http': {data['url']}\"\n\n    if \"mode\" in data:\n        assert data[\"mode\"] == \"subscription\", f\"Checkout session mode is not 'subscription', got: {data['mode']}\"\n    if \"payment_status\" in data:\n        assert data[\"payment_status\"] in {\"unpaid\", \"paid\"}, f\"Invalid payment status in checkout session response: {data['payment_status']}\"\n\ntest_billing_create_checkout_session_api()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 49, in <module>\n  File \"<string>\", line 36, in test_billing_create_checkout_session_api\nAssertionError: Response missing 'id' field: {'status': 'ok'}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.720Z",
    "modified": "2025-11-20T17:58:38.764Z"
  },
  {
    "projectId": "8fc77480-0afb-4f23-b239-ab2773f10ba3",
    "testId": "b1aeb1b4-4a2e-4819-8675-0444d83edfb6",
    "userId": "c4c8e4f8-b0a1-70e1-4a7e-866ccd471943",
    "title": "TC010-test_audit_logs_retrieval_api",
    "description": "Verify that the /api/audit/logs endpoint retrieves audit logs for user actions and document interactions, ensuring compliance and traceability.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_audit_logs_retrieval_api():\n    url = f\"{BASE_URL}/api/audit/logs\"\n    headers = {\n        \"Accept\": \"application/json\",\n    }\n\n    try:\n        response = requests.get(url, headers=headers, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Request to /api/audit/logs failed with exception: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    # Basic validation of audit logs structure: expect a list or dict with audit logs\n    assert isinstance(data, (list, dict)), \"Response JSON should be a list or dict\"\n\n    # If list, check elements have expected keys for audit logs\n    if isinstance(data, list) and len(data) > 0:\n        first_log = data[0]\n        assert isinstance(first_log, dict), \"Each audit log entry should be a dict\"\n        # Check presence of typical audit log fields\n        expected_keys = {\"timestamp\", \"user_id\", \"action\", \"resource\", \"details\"}\n        missing_keys = expected_keys - first_log.keys()\n        assert not missing_keys, f\"Audit log entry missing keys: {missing_keys}\"\n    elif isinstance(data, dict):\n        # If dict, check it contains keys for audit log data\n        # This is generic since the schema is not specified\n        assert len(data) > 0, \"Audit logs dict response should not be empty\"\n\ntest_audit_logs_retrieval_api()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 40, in <module>\n  File \"<string>\", line 17, in test_audit_logs_retrieval_api\nAssertionError: Expected status code 200, got 404\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-20T17:57:39.725Z",
    "modified": "2025-11-20T17:58:24.112Z"
  }
]
